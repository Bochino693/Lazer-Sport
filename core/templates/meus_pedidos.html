{% extends "base.html" %}
{% block content %}

<style>
/* üåà Background geral */
body {
    background: linear-gradient(180deg, #f5f7fb 0%, #eef1f6 100%);
}

/* üìç Breadcrumb */
.breadcrumb-strong {
    max-width: 1100px;
    margin: 20px auto 10px;
    font-size: 0.95rem;
    font-weight: 700;
    color: #6c757d;
}

.breadcrumb-strong a {
    color: #0d6efd;
    text-decoration: none;
}

.breadcrumb-strong span {
    margin: 0 6px;
}

/* üì¶ Container */
.pedidos-container {
    max-width: 1100px;
    margin: 10px auto 60px;
    padding: 20px;
}

/* üßæ Header */
.pedidos-header {
    background: linear-gradient(135deg, #0d6efd, #4f8cff);
    color: #fff;
    border-radius: 22px;
    padding: 28px;
    margin-bottom: 30px;
    box-shadow: 0 20px 40px rgba(13,110,253,0.25);
}

.pedidos-header h1 {
    font-weight: 900;
    margin-bottom: 6px;
}

.pedidos-header p {
    opacity: 0.9;
}

/* üß± Card do pedido */
.pedido-card {
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(6px);
    border-radius: 22px;
    padding: 24px;
    margin-bottom: 26px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.08);
    transition: transform .2s ease, box-shadow .2s ease;
}

.pedido-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 25px 60px rgba(0,0,0,0.12);
}

/* üß© Header do pedido */
.pedido-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
}

.pedido-id {
    font-weight: 900;
    font-size: 1.15rem;
}

/* üü¢ Status */
.status {
    padding: 8px 18px;
    border-radius: 30px;
    font-size: 0.8rem;
    font-weight: 800;
    text-transform: uppercase;
}

.status-aguardando_pagamento {
    background: #fff3cd;
    color: #856404;
    box-shadow: 0 0 0 3px rgba(255,193,7,.15);
}

.status-pago {
    background: #d4edda;
    color: #155724;
    box-shadow: 0 0 0 3px rgba(40,167,69,.15);
}

.status-em_preparacao {
    background: #e7f1ff;
    color: #0d6efd;
}

.status-finalizado {
    background: #e6f4ea;
    color: #137333;
}

.status-cancelado {
    background: #fde2e4;
    color: #9b1c1c;
}

/* üìä Infos */
.pedido-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin: 20px 0;
}

.info-box {
    background: #f8f9fc;
    border-radius: 16px;
    padding: 14px 16px;
}

.info-box small {
    color: #6c757d;
}

.valor-total {
    font-size: 1.3rem;
    font-weight: 900;
    color: #0d6efd;
}

/* üßæ Itens */
.itens-lista {
    margin-top: 16px;
    border-top: 1px dashed #ddd;
    padding-top: 14px;
    animation: fadeIn .3s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* üîò Bot√µes */
.toggle-itens {
    margin-top: 10px;
    background: none;
    border: none;
    color: #0d6efd;
    font-weight: 800;
    cursor: pointer;
}

.btn-finalizar {
    margin-top: 18px;
    display: inline-block;
    padding: 10px 20px;
    border-radius: 30px;
    background: linear-gradient(135deg, #198754, #28a745);
    color: #fff;
    font-weight: 800;
    text-decoration: none;
    box-shadow: 0 10px 25px rgba(40,167,69,.3);
}

/* üßæ Item */
.item-detalhe {
    display: grid;
    grid-template-columns: 64px 1fr auto;
    gap: 14px;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px dashed #ddd;
}

.item-img img {
    width: 64px;
    height: 64px;
    object-fit: cover;
    border-radius: 12px;
}

.img-placeholder {
    width: 64px;
    height: 64px;
    border-radius: 12px;
    background: #f1f3f5;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
}

.item-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.item-info small {
    color: #6c757d;
    font-size: 0.8rem;
}

.item-subtotal {
    font-weight: 900;
    color: #0d6efd;
}

/* üìå Rodap√© do pedido */
.pedido-footer {
    margin-top: 18px;
    padding-top: 14px;
    border-top: 1px dashed #ddd;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 14px;
    align-items: center;
}

.footer-item {
    background: #f8f9fc;
    border-radius: 14px;
    padding: 10px 14px;
    text-align: center;
}

.footer-item small {
    display: block;
    font-size: 0.75rem;
    color: #6c757d;
}

.footer-item strong {
    font-size: 1rem;
    font-weight: 900;
}

.footer-item.total strong {
    color: #0d6efd;
    font-size: 1.15rem;
}

.footer-item.desconto strong {
    color: #dc3545;
}

.footer-item.cupom {
    background: linear-gradient(135deg, #fff3cd, #ffe69c);
}

/* üìç Endere√ßo de entrega */
.endereco-card {
    margin-top: 20px;
    border-radius: 18px;
    background: linear-gradient(135deg, #f8f9fc, #eef2ff);
    box-shadow: 0 10px 30px rgba(13,110,253,.08);
    overflow: hidden;
    text-align: center;
}

.endereco-header {
    padding: 12px 18px;
    font-weight: 900;
    font-size: 0.9rem;
    color: #0d6efd;
    background: rgba(13,110,253,.08);
    text-align: center;
}

.endereco-body {
    padding: 16px 18px;
    font-size: 0.9rem;
    color: #343a40;
}

.endereco-body p {
    margin: 0 0 6px;
    line-height: 1.4;
}

.endereco-body strong {
    font-weight: 900;
}

.endereco-body .telefone {
    margin-top: 8px;
    font-weight: 800;
    color: #198754;
}


/* badge base */
.pedido-status {
    position: absolute;
    top: 14px;
    right: 14px;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #fff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

/* cores por status */
.status-criado {
    background: #9ca3af; /* cinza */
}

.status-aguardando_pagamento {
    background: #f59e0b; /* amarelo */
}

.status-pago {
    background: #22c55e; /* verde */
}

.status-em_preparacao {
    background: #3b82f6; /* azul */
}

.status-finalizado {
    background: #16a34a; /* verde escuro */
}

.status-cancelado {
    background: #ef4444; /* vermelho */
}


.entrega-box {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-top: 12px;
    padding: 16px;
    border-radius: 14px;
    background: #f8f9fa;
    border: 1px solid #e9ecef;
}

.endereco-col h4 {
    margin: 0 0 6px;
    font-size: 0.85rem;
    font-weight: 700;
    color: #495057;
}

.endereco-col p {
    margin: 0;
    font-size: 0.8rem;
    color: #6c757d;
    line-height: 1.4;
}

.entrega-metricas {
    grid-column: span 2;
    margin-top: 12px;
    padding-top: 10px;
    border-top: 1px dashed #dee2e6;
    font-size: 0.85rem;
    font-weight: 700;
    color: #212529;
    text-align: center;
}

/* Card moderno de endere√ßo */
.endereco-card.modern-card {
    background: linear-gradient(145deg, #ffffff, #f1f5f9);
    border-radius: 18px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
    padding: 20px;
    margin-top: 20px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.endereco-card.modern-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 20px 45px rgba(0, 0, 0, 0.12);
}

/* Cabe√ßalho */
.endereco-header.modern-header {
    font-size: 1.1rem;
    font-weight: 900;
    color: #0d6efd;
    background: rgba(13, 110, 253, 0.08);
    text-align: center;
    padding: 14px;
    border-radius: 14px;
    margin-bottom: 18px;
    box-shadow: inset 0 -2px 4px rgba(13, 110, 253, 0.1);
}

/* Body */
.endereco-body.modern-body {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
}

/* Colunas */
.endereco-col.modern-col {
    background: #ffffff;
    border-radius: 14px;
    padding: 14px 16px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.endereco-col.modern-col:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.08);
}

.endereco-col h4 {
    font-size: 0.9rem;
    font-weight: 700;
    color: #495057;
    margin-bottom: 8px;
}

.endereco-col p {
    font-size: 0.85rem;
    color: #6c757d;
    line-height: 1.4;
    margin: 0;
}

/* M√©tricas de entrega */
.entrega-metricas.modern-metrics {
    grid-column: span 2;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 14px 0;
    margin-top: 10px;
    border-radius: 12px;
    background: linear-gradient(135deg, #e7f1ff, #f0f8ff);
    font-weight: 700;
    color: #0d6efd;
    box-shadow: 0 6px 15px rgba(13, 110, 253, 0.1);
    font-size: 0.95rem;
}

.entrega-metricas.modern-metrics div {
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* üì± Responsividade Mobile */
@media (max-width: 768px) {

    /* Ajusta container principal */
    .pedidos-container {
        padding: 16px;
        margin: 10px auto 40px;
    }

    /* Header do pedido */
    .pedidos-header {
        padding: 20px;
        border-radius: 16px;
    }

    .pedidos-header h1 {
        font-size: 1.5rem;
    }

    .pedidos-header p {
        font-size: 0.85rem;
    }

    /* Cards do pedido */
    .pedido-card {
        padding: 16px;
        border-radius: 16px;
    }

    /* Pedido info grid */
    .pedido-info {
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin: 16px 0;
    }

    .info-box {
        padding: 12px 14px;
    }

    .valor-total {
        font-size: 1.15rem;
    }

    /* Footer do pedido */
    .pedido-footer {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        padding-top: 12px;
    }

    .footer-item {
        padding: 8px 10px;
    }

    .footer-item strong {
        font-size: 0.9rem;
    }

    .footer-item.total strong {
        font-size: 1rem;
    }

    /* Itens */
    .item-detalhe {
        grid-template-columns: 50px 1fr auto;
        gap: 10px;
        padding: 10px 0;
    }

    .item-img img, .img-placeholder {
        width: 50px;
        height: 50px;
    }

    .item-info small {
        font-size: 0.75rem;
    }

    .item-subtotal {
        font-size: 0.85rem;
    }

    /* Bot√µes */
    .toggle-itens {
        font-size: 0.85rem;
    }

    .btn-finalizar {
        padding: 8px 16px;
        font-size: 0.85rem;
    }

    /* Endere√ßo de entrega */
    .endereco-card.modern-card {
        padding: 16px;
    }

    .endereco-header.modern-header {
        font-size: 1rem;
        padding: 12px;
    }

    .endereco-body.modern-body {
        grid-template-columns: 1fr;
        gap: 14px;
    }

    .endereco-col.modern-col {
        padding: 12px 14px;
    }

    .endereco-col h4 {
        font-size: 0.85rem;
    }

    .endereco-col p {
        font-size: 0.8rem;
    }

    .entrega-metricas.modern-metrics {
        flex-direction: column;
        font-size: 0.85rem;
        padding: 10px 0;
    }

    .entrega-metricas.modern-metrics div {
        margin-bottom: 6px;
    }
}

/* üì± Extra small (celulares pequenos) */
@media (max-width: 480px) {
    .pedido-info {
        grid-template-columns: 1fr;
    }
    .pedido-footer {
        grid-template-columns: 1fr;
    }
    .item-detalhe {
        grid-template-columns: 40px 1fr;
    }
    .item-subtotal {
        display: block;
        margin-top: 6px;
    }
    .toggle-itens {
        font-size: 0.8rem;
    }
    .pedidos-header h1 {
        font-size: 1.35rem;
    }
}


</style>

<!-- üìç Breadcrumb -->
<div class="breadcrumb-strong">
    <a href="{% url 'home' %}">In√≠cio</a>
    <span>‚Ä∫</span>
    <strong>Meus Pedidos</strong>
</div>

<section class="pedidos-container" id="pedidos">

    <!-- üì¶ Header -->
    <div class="pedidos-header">
        <h1>üì¶ Meus Pedidos</h1>
        <p>Acompanhe pagamentos, status e itens comprados</p>
    </div>

{% if pedidos %}
    {% for pedido in pedidos %}
    <div class="pedido-card">

        <div class="pedido-header">
            <div class="pedido-id">
                Pedido #{{ pedido.id }} <br>
                <small>{{ pedido.criacao|date:"d/m/Y H:i" }}</small>
            </div>
        </div>

        <div class="pedido-info">
            <div class="info-box">
                <small>Total bruto</small><br>
                <span class="money" data-valor="{{ pedido.total_bruto }}"></span>
            </div>
            <div class="info-box">
                <small>Desconto</small><br>
                <span class="money desconto" data-valor="{{ pedido.valor_desconto }}"></span>
            </div>
            <div class="info-box valor-total">
                Total<br>
                <span class="money total" data-valor="{{ pedido.total_liquido }}"></span>
            </div>
        </div>

        <div class="pedido-footer">
            <div class="footer-item">
                <small>Total bruto</small>
                <strong class="money" data-valor="{{ pedido.total_bruto }}"></strong>
            </div>
            <div class="footer-item desconto">
                <small>Desconto</small>
                <strong class="money desconto" data-valor="{{ pedido.valor_desconto }}"></strong>
            </div>
            <div class="footer-item total">
                <small>Total final</small>
                <strong class="money total" data-valor="{{ pedido.total_liquido }}"></strong>
            </div>
            {% if pedido.cupom_codigo %}
            <div class="footer-item cupom">
                <small>Cupom</small>
                <strong>üéüÔ∏è {{ pedido.cupom_codigo }}</strong>
            </div>
            {% endif %}
        </div>

       {% if pedido.endereco %}
<div class="endereco-card modern-card">
    <div class="endereco-header modern-header">
        üöö Informa√ß√µes de Entrega
    </div>

    <div class="endereco-body modern-body">
        <!-- Origem (Empresa) -->
        <div class="endereco-col modern-col">
            <h4>üè≠ Origem</h4>
            {% if empresa %}
                <p>
                    <strong>{{ empresa.rua }}</strong>, {{ empresa.numero }}<br>
                    {{ empresa.bairro }}<br>
                    {{ empresa.cidade }}/{{ empresa.estado }}<br>
                    CEP {{ empresa.cep }}<br>
                    {% if empresa.telefone %}üìû {{ empresa.telefone }}{% endif %}
                </p>
            {% else %}
                <p>Endere√ßo da empresa n√£o cadastrado.</p>
            {% endif %}
        </div>

        <!-- Destino (Cliente) -->
        <div class="endereco-col modern-col">
            <h4>üìç Destino</h4>
            <p>
                <strong>{{ pedido.endereco.rua }}</strong>, {{ pedido.endereco.numero }}
                {% if pedido.endereco.complemento %} ‚Äì {{ pedido.endereco.complemento }}{% endif %}<br>
                {{ pedido.endereco.bairro }}<br>
                {{ pedido.endereco.cidade }}/{{ pedido.endereco.estado }}<br>
                CEP {{ pedido.endereco.cep }}<br>
                {% if pedido.endereco.telefone %}üìû {{ pedido.endereco.telefone }}{% endif %}
            </p>
        </div>

        <!-- M√©tricas de entrega -->
        {% if pedido.distancia_km and pedido.tempo_estimado_min %}
        <div class="entrega-metricas modern-metrics">
            <div>
                Dist√¢ncia em KM üöö <strong>{{ pedido.distancia_km }} km</strong>
            </div>
            <div>
                Tempo de transporte aproximado ‚è±Ô∏è <strong>{{ pedido.tempo_estimado_min }} min</strong>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

        <button class="toggle-itens" onclick="toggleItens({{ pedido.id }})">Ver detalhes do pedido</button>

        <div class="itens-lista" id="itens-{{ pedido.id }}" style="display:none;">
            {% for item in pedido.itens.all %}
            <div class="item-detalhe">
                <div class="item-img">
                    {% if item.item_original and item.item_original.imagem_brinquedo %}
                        <img src="{{ item.item_original.imagem_brinquedo.url }}">
                    {% else %}
                        <div class="img-placeholder">üì¶</div>
                    {% endif %}
                </div>
                <div class="item-info">
                    <strong>{{ item.nome_item }}</strong>
                    <small>Quantidade: {{ item.quantidade }}</small>
                    <small>
                        Pre√ßo unit√°rio: <span class="money" data-valor="{{ item.preco_unitario }}"></span>
                    </small>
                </div>
                <div class="item-subtotal money" data-valor="{{ item.subtotal|floatformat:2 }}"></div>
            </div>
            {% endfor %}
        </div>

    </div>
    {% endfor %}
{% else %}
    <p style="margin-top:40px; color:#777">
        Voc√™ ainda n√£o realizou nenhum pedido.
    </p>
{% endif %}

</section>

<script>
function toggleItens(id) {
    const el = document.getElementById(`itens-${id}`);
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
}

function formatarBRL(valor) {
    if (valor === null || valor === undefined || valor === '') {
        return 'R$ 0,00';
    }

    return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
    }).format(parseFloat(valor));
}

document.querySelectorAll('.money').forEach(el => {
    const valor = el.dataset.valor;
    el.textContent = formatarBRL(valor);
});

</script>

{% endblock %}
