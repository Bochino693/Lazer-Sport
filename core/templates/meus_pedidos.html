{% extends "base.html" %}
{% block content %}

<style>
/* üåà Background geral */
body {
    background: linear-gradient(180deg, #f5f7fb 0%, #eef1f6 100%);
}

/* üìç Breadcrumb */
.breadcrumb-strong {
    max-width: 1100px;
    margin: 20px auto 10px;
    font-size: 0.95rem;
    font-weight: 700;
    color: #6c757d;
}

.breadcrumb-strong a {
    color: #0d6efd;
    text-decoration: none;
}

.breadcrumb-strong span {
    margin: 0 6px;
}

/* üì¶ Container */
.pedidos-container {
    max-width: 1100px;
    margin: 10px auto 60px;
    padding: 20px;
}

/* üßæ Header */
.pedidos-header {
    background: linear-gradient(135deg, #0d6efd, #4f8cff);
    color: #fff;
    border-radius: 22px;
    padding: 28px;
    margin-bottom: 30px;
    box-shadow: 0 20px 40px rgba(13,110,253,0.25);
}

.pedidos-header h1 {
    font-weight: 900;
    margin-bottom: 6px;
}

.pedidos-header p {
    opacity: 0.9;
}

/* üß± Card do pedido */
.pedido-card {
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(6px);
    border-radius: 22px;
    padding: 24px;
    margin-bottom: 26px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.08);
    transition: transform .2s ease, box-shadow .2s ease;
}

.pedido-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 25px 60px rgba(0,0,0,0.12);
}

/* üß© Header do pedido */
.pedido-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
}

.pedido-id {
    font-weight: 900;
    font-size: 1.15rem;
}

/* üü¢ Status */
.status {
    padding: 8px 18px;
    border-radius: 30px;
    font-size: 0.8rem;
    font-weight: 800;
    text-transform: uppercase;
}

.status-aguardando_pagamento {
    background:#fff3cd;
    color:#856404;
    box-shadow: 0 0 0 3px rgba(255,193,7,.15);
}

.status-pago {
    background:#d4edda;
    color:#155724;
    box-shadow: 0 0 0 3px rgba(40,167,69,.15);
}

.status-em_preparacao {
    background:#e7f1ff;
    color:#0d6efd;
}

.status-finalizado {
    background:#e6f4ea;
    color:#137333;
}

.status-cancelado {
    background:#fde2e4;
    color:#9b1c1c;
}

/* üìä Infos */
.pedido-info {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
    gap: 16px;
    margin: 20px 0;
}

.info-box {
    background:#f8f9fc;
    border-radius: 16px;
    padding: 14px 16px;
}

.info-box small {
    color:#6c757d;
}

.valor-total {
    font-size: 1.3rem;
    font-weight: 900;
    color: #0d6efd;
}

/* üßæ Itens */
.itens-lista {
    margin-top: 16px;
    border-top: 1px dashed #ddd;
    padding-top: 14px;
    animation: fadeIn .3s ease;
}

@keyframes fadeIn {
    from { opacity:0; transform: translateY(-5px); }
    to { opacity:1; transform: translateY(0); }
}

.item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 0.95rem;
}

/* üîò Bot√µes */
.toggle-itens {
    margin-top: 10px;
    background: none;
    border: none;
    color: #0d6efd;
    font-weight: 800;
    cursor: pointer;
}

.btn-finalizar {
    margin-top: 18px;
    display: inline-block;
    padding: 10px 20px;
    border-radius: 30px;
    background: linear-gradient(135deg,#198754,#28a745);
    color:#fff;
    font-weight: 800;
    text-decoration: none;
    box-shadow: 0 10px 25px rgba(40,167,69,.3);
}

.item-detalhe {
    display: grid;
    grid-template-columns: 64px 1fr auto;
    gap: 14px;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px dashed #ddd;
}

.item-img img {
    width: 64px;
    height: 64px;
    object-fit: cover;
    border-radius: 12px;
}

.img-placeholder {
    width: 64px;
    height: 64px;
    border-radius: 12px;
    background: #f1f3f5;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
}

.item-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.item-info small {
    color: #6c757d;
    font-size: 0.8rem;
}

.item-subtotal {
    font-weight: 900;
    color: #0d6efd;
}

</style>

<!-- üìç Breadcrumb strong -->
<div class="breadcrumb-strong">
    <a href="{% url 'home' %}">In√≠cio</a>
    <span>‚Ä∫</span>
    <strong>Meus Pedidos</strong>
</div>

<section class="pedidos-container">

    <!-- üì¶ Header -->
    <div class="pedidos-header">
        <h1>üì¶ Meus Pedidos</h1>
        <p>Acompanhe pagamentos, status e itens comprados</p>
    </div>

    {% if not pedidos %}
        <p style="margin-top:40px; color:#777">
            Voc√™ ainda n√£o realizou nenhum pedido.
        </p>
    {% endif %}

    {% for pedido in pedidos %}
    <div class="pedido-card">

        <div class="pedido-header">
            <div class="pedido-id">Pedido #{{ pedido.id }}</div>
            <span class="status status-{{ pedido.status }}">
                {{ pedido.get_status_display }}
            </span>
        </div>

        <div class="pedido-info">
            <div class="info-box">
                <small>Total bruto</small><br>
                R$ {{ pedido.total_bruto|floatformat:2 }}
            </div>

            <div class="info-box">
                <small>Desconto</small><br>
                R$ {{ pedido.valor_desconto|floatformat:2 }}
            </div>

            <div class="info-box valor-total">
                Total<br>
                R$ {{ pedido.total_liquido|floatformat:2 }}
            </div>
        </div>

        {% if pedido.cupom_codigo %}
            <small>üéüÔ∏è Cupom aplicado: <strong>{{ pedido.cupom_codigo }}</strong></small>
        {% endif %}

        <button class="toggle-itens" onclick="toggleItens({{ pedido.id }})">
            Ver detalhes do pedido
        </button>

        <div class="itens-lista" id="itens-{{ pedido.id }}" style="display:none;">
            {% for item in pedido.itens.all %}
    <div class="item-detalhe">

        <div class="item-img">
            {% if item.item_original and item.item_original.imagem_brinquedo %}
                <img src="{{ item.item_original.imagem_brinquedo.url }}">
            {% else %}
                <div class="img-placeholder">üì¶</div>
            {% endif %}
        </div>

        <div class="item-info">
            <strong>{{ item.nome_item }}</strong>
            <small>Quantidade: {{ item.quantidade }}</small>
            <small>Pre√ßo unit√°rio: R$ {{ item.preco_unitario|floatformat:2 }}</small>
        </div>

        <div class="item-subtotal">
            R$ {{ item.subtotal|floatformat:2 }}
        </div>

    </div>
    {% endfor %}
        </div>

        {% if pedido.status == 'aguardando_pagamento' %}
            <a href="#" class="btn-finalizar">
                üí∞ Confirmar pagamento
            </a>
        {% endif %}

    </div>
    {% endfor %}

</section>

<script>
function toggleItens(id) {
    const el = document.getElementById(`itens-${id}`);
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
}
</script>

{% endblock %}
