{% extends "base_adm.html" %}
{% block content %}

<style>
.manutencoes-container {
    max-width:1200px;
    margin:40px auto;
    padding:20px;
}

.manutencoes-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:30px;
}

.manutencoes-header h1 {
    font-size:1.9rem;
}

/* ===== GRID ===== */
.grid-manutencoes {
     display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 22px;
    align-items: stretch;
}

/* ===== CARD ===== */
.manut-card {
    background:#fff;
    border-radius:22px;
    padding:26px 28px;
    box-shadow:0 14px 40px rgba(0,0,0,.12);
    display:flex;
    flex-direction:column;
    gap:18px;
    transition:.25s;
    height: 100%;
     display: flex;
    justify-content: space-between;
     text-align:center;

}

.manut-card:hover {
    transform:translateY(-6px);
}

/* ===== TOPO ===== */
.manut-top {
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.manut-brinquedo {
    font-weight:900;
    font-size:1.25rem;
    color:#2575fc;
}

/* ===== STATUS ===== */
.status {
    padding:8px 18px;
    border-radius:30px;
    font-size:.8rem;
    font-weight:800;
    text-transform:uppercase;
    letter-spacing:.4px;
}


.status-P { background:#fff3cd; color:#856404; }
.status-A { background:#cce5ff; color:#004085; }
.status-C { background:#d4edda; color:#155724; }
.status-X { background:#f8d7da; color:#721c24; }

/* ===== INFO ===== */
.manut-info {
    font-size:1rem;
    color:#444;
    line-height:1.55;
}

.manut-info strong {
    font-weight:700;
    color:#111;
}

/* ===== ENDERE√áO ===== */
.manut-endereco {
    font-size:.95rem;
    color:#555;
    line-height:1.4;
}

.manut-info + .manut-info {
    font-size:1rem;
    color:#333;
    line-height:1.6;
}

/* ===== IMAGENS ===== */
.manut-imagens {
    display:flex;
    gap:10px;
    margin-top:6px;
}

.manut-imagens img {
    width:64px;
    height:64px;
    object-fit:cover;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.15);
}

/* ===== A√á√ïES ===== */
.manut-acoes {
    display:flex;
    gap:10px;
    margin-top:10px;
}

.manut-acoes a {
    flex:1;
    text-align:center;
    padding:12px;
    border-radius:16px;
    font-weight:800;
    text-decoration:none;
    font-size:.9rem;
}


.btn-ver {
    background:#2575fc;
    color:#fff;
}

.btn-status {
    background:#6a11cb;
    color:#fff;
}

/* ===== DATA ===== */
.manut-data {
    font-size:.8rem;
    color:#666;
    text-align:center;
}

.manut-footer {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

    /* ===== FUNDO POR STATUS ===== */
.status-bg-P {
    background: linear-gradient(
        90deg,
        rgba(255,193,7,.15) 0%,
        #fff 25%
    );
    border-left: 6px solid #ffc107;
}

.status-bg-A {
    background: linear-gradient(
        90deg,
        rgba(13,110,253,.12) 0%,
        #fff 25%
    );
    border-left: 6px solid #0d6efd;
}

.status-bg-C {
    background: linear-gradient(
        90deg,
        rgba(40,167,69,.12) 0%,
        #fff 25%
    );
    border-left: 6px solid #28a745;
}

.status-bg-X {
    background: linear-gradient(
        90deg,
        rgba(220,53,69,.12) 0%,
        #fff 25%
    );
    border-left: 6px solid #dc3545;
}


.modal-manut {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: none;
}

.modal-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(4px);
}



@keyframes modalIn {
    from { opacity:0; transform:translateY(20px) scale(.96); }
    to { opacity:1; transform:none; }
}

.modal-close {
    position:absolute;
    top:18px;
    right:22px;
    border:none;
    background:none;
    font-size:1.4rem;
    cursor:pointer;
}

.modal-section {
    margin-top:18px;
}

.modal-section strong {
    display:block;
    margin-bottom:6px;
}
/* FUNDO */
#modalManutencao .modal-content {
    text-align: center;
}

/* FOR√áA TEXTO ESCURO (sobrescreve heran√ßa branca) */
#modalManutencao h2,
#modalManutencao p,
#modalManutencao strong,
#modalManutencao span {
    color: #111 !important;
}

/* T√≠tulo principal */
#modalManutencao h2 {
    color: #000 !important;
    font-weight: 700;
    margin-bottom: 10px;
}

/* Se√ß√µes */
#modalManutencao .modal-section {
    text-align: center;
    margin-top: 15px;
}

/* Status badge (opcional, melhora contraste) */
#modalManutencao .status {
    color: #fff !important;
}

/* Imagens centralizadas */
#modalManutencao .modal-imagens {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
}

.lightbox {
    position:fixed;
    inset:0;
    display:none;
    z-index:10000;
}

.lightbox-overlay {
    position:absolute;
    inset:0;
    background:rgba(0,0,0,.7);
}

.lightbox-content {
    position:relative;
    max-width:90%;
    margin:5vh auto;
    text-align:center;
}

.lightbox-content img {
    max-height:70vh;
    border-radius:18px;
}

.lightbox-actions {
    margin-top:12px;
    display:flex;
    justify-content:center;
    gap:12px;
}


</style>

<div class="manutencoes-container">

    <div class="manutencoes-header">
        <h1>üõ†Ô∏è Manuten√ß√µes Solicitadas</h1>
    </div>

    <div class="grid-manutencoes">
        {% for m in manutencoes %}
        <div class="manut-card status-bg-{{ m.status }}">

            <div class="manut-top">
                <div class="manut-brinquedo">
                    {{ m.brinquedo.nome_brinquedo }}
                </div>

                <span class="status status-{{ m.status }}">
                    {{ m.get_status_display }}
                </span>
            </div>

            <div class="manut-info">
                <strong>Cliente:</strong> {{ m.usuario }} <br>
                <strong>Telefone:</strong> {{ m.telefone_contato }}
            </div>

            <div class="manut-info">
                <strong>Problema:</strong><br>
                {{ m.descricao|truncatechars:120 }}
            </div>

            <div class="manut-endereco">
                üìç {{ m.endereco }}, {{ m.numero }} ‚Äì {{ m.bairro }} <br>
                {{ m.cidade }}/{{ m.estado }} ‚Ä¢ CEP {{ m.cep }}
            </div>

            {% if m.imagens.all %}
            <div class="manut-imagens">
                {% for img in m.imagens.all|slice:":3" %}
                    <img src="{{ img.imagem.url }}">
                {% endfor %}
            </div>
            {% endif %}

            <div class="manut-footer">
                <div class="manut-acoes">
                    <a href="#"
                       class="btn-ver"
                       onclick="abrirModalManutencao(this)"
                       data-brinquedo="{{ m.brinquedo.nome_brinquedo }}"
                       data-cliente="{{ m.usuario }}"
                       data-telefone="{{ m.telefone_contato }}"
                       data-descricao="{{ m.descricao|escapejs }}"
                       data-endereco="{{ m.endereco }}, {{ m.numero }} - {{ m.bairro }} | {{ m.cidade }}/{{ m.estado }}"
                       data-status="{{ m.get_status_display }}"
                    >
                        üëÅÔ∏è Ver
                    </a>
                    <a href="#" class="btn-status">üîÑ Status</a>
                </div>

                <div class="manut-data">
                    Criado em {{ m.criado_em|date:"d/m/Y H:i" }}
                </div>
            </div>


              </div>
        {% empty %}
            <p>Nenhuma manuten√ß√£o encontrada.</p>
        {% endfor %}
    </div>


<div id="modalManutencao" class="modal-manut">
    <div class="modal-overlay" onclick="fecharModalManutencao()"></div>

    <div class="modal-content">
        <button class="modal-close" onclick="fecharModalManutencao()">‚úï</button>

        <h2 id="modalBrinquedo"></h2>

        <div class="modal-badges">
            <span id="modalStatus" class="status"></span>
        </div>

        <div class="modal-section">
            <strong>üë§ Cliente</strong>
            <p id="modalCliente"></p>
            <p id="modalTelefone"></p>
        </div>

        <div class="modal-section">
            <strong>üõ†Ô∏è Descri√ß√£o</strong>
            <p id="modalDescricao"></p>
        </div>

        <div class="modal-section">
            <strong>üìç Endere√ßo</strong>
            <p id="modalEndereco"></p>
        </div>

        <div class="modal-section">
            <strong>üñºÔ∏è Imagens</strong>
            <div id="modalImagens" class="modal-imagens"></div>
        </div>
    </div>
</div>

<!-- ===== LIGHTBOX (IMAGEM AMPLIADA) ===== -->
<div id="lightbox" class="lightbox">
    <div class="lightbox-overlay" onclick="fecharLightbox()"></div>
    <div class="lightbox-content">
        <img id="lightboxImg">
        <div class="lightbox-actions">
            <a id="downloadImg" download class="btn-ver">‚¨áÔ∏è Baixar</a>
            <button onclick="compartilharImagem()" class="btn-status">üîó Compartilhar</button>
        </div>
    </div>
</div>



</div>




<script>
function abrirModalManutencao(btn){
    document.getElementById("modalManutencao").style.display = "block";

    document.getElementById("modalBrinquedo").innerText = btn.dataset.brinquedo;
    document.getElementById("modalCliente").innerText = btn.dataset.cliente;
    document.getElementById("modalTelefone").innerText = "üìû " + btn.dataset.telefone;
    document.getElementById("modalDescricao").innerText = btn.dataset.descricao;
    document.getElementById("modalEndereco").innerText = btn.dataset.endereco;

    const status = document.getElementById("modalStatus");
    status.innerText = btn.dataset.status;
    status.className = "status";

    document.getElementById("modalImagens").innerHTML = "";

    // carrega imagens do card
    const imagens = btn.closest(".manut-card").querySelectorAll(".manut-imagens img");
    imagens.forEach(img => {
        const clone = document.createElement("img");
        clone.src = img.src;
        clone.onclick = () => abrirImagemGrande(img.src);
        document.getElementById("modalImagens").appendChild(clone);
    });
}

function fecharModalManutencao(){
    document.getElementById("modalManutencao").style.display = "none";
}


let imgAtual = "";

function abrirImagemGrande(src){
    imgAtual = src;
    document.getElementById("lightboxImg").src = src;
    document.getElementById("downloadImg").href = src;
    document.getElementById("lightbox").style.display = "block";
}

function fecharLightbox(){
    document.getElementById("lightbox").style.display = "none";
}

function compartilharImagem(){
    if(navigator.share){
        navigator.share({
            title: "Imagem da Manuten√ß√£o",
            url: imgAtual
        });
    } else {
        alert("Compartilhamento n√£o suportado neste navegador.");
    }
}


</script>


{% endblock %}
