{% extends "base.html" %}
{% load static %}

{% block content %}

<style>


/* ===== override breadcrumb (template m√£e) ===== */
.breadcrumb {
    font-weight: 600; /* bold normal */
}

.breadcrumb a,
.breadcrumb span,
.breadcrumb strong {
    color: #444 !important; /* ajuste se quiser */
    font-weight: 600;
}

/* hover suave */
.breadcrumb a:hover {
    color: #0d6efd !important;
}


/* ===== CONTAINER ===== */
.produto-container {
    max-width: 1100px;
    margin: 40px auto;
    padding: 30px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    background: #ffffff;
    border-radius: 22px;
    box-shadow: 0 10px 35px rgba(0,0,0,0.08);
    align-items: start;
}

/* ===== IMAGEM WRAPPER ===== */
.produto-img {
    position: relative;
    overflow: hidden;
    border-radius: 22px;
    background: linear-gradient(180deg,#f8f9fa,#eef1f4);
}

/* ===== IMAGEM ===== */
.produto-img img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 22px;
    transition: transform .5s ease, filter .4s ease;
}

/* efeito premium hover */
.produto-img:hover img {
    transform: scale(1.06);
    filter: brightness(1.03);
}

/* ===== INFO ===== */
.produto-info {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
}

.produto-info h1 {
    font-size: 2rem;
    font-weight: 700;
    color: #222;
    margin-bottom: 10px;
    line-height: 1.2;
}

/* ===== PRE√áO ===== */
.preco {
    font-size: 2.1rem;
    font-weight: 800;
    color: #0d6efd;
    margin-bottom: 18px;
    letter-spacing: -0.5px;
}

/* ===== DESCRI√á√ÉO ===== */
.sec-titulo {
    font-size: 1.05rem;
    font-weight: 700;
    margin-top: 20px;
    margin-bottom: 6px;
    color: #2c2c2c;
}

.descricao-produto {
    font-size: 1rem;
    line-height: 1.75;
    color: #495057;
    background: #f8f9fa;
    padding: 14px 16px;
    border-radius: 12px;
    border: 1px solid #eef1f4;
}

/* ===== PRE√áO PRINCIPAL ===== */
/* ===== PRE√áO PRINCIPAL ===== */
.preco {
    font-size: 2.2rem;
    font-weight: 800;
    color: #0d6efd;
    margin: 12px 0 22px;
    letter-spacing: -0.5px;
    text-align: left;
}

/* pre√ßo fornecedor */
.preco-fornecedor {
    font-size: 1.05rem;
    color: #6c757d;
    font-weight: 600;
}

.produto-info {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 6px;
}


/* ===== BOT√ïES ===== */
.acoes-produto {
    margin-top: 26px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.btn-acao {
    display: block;
    width: 100%;
    padding: 13px 0;
    border-radius: 14px;
    font-weight: 700;
    text-align: center;
    text-decoration: none;
    transition: .25s ease;
    font-size: .95rem;
}

/* WhatsApp */
.btn-whatsapp {
    background: linear-gradient(135deg, #25D366, #1ebe5d);
    color: white;
}

.btn-whatsapp:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 18px rgba(37,211,102,.35);
}

/* Carrinho */
.btn-carrinho {
    background: #0d6efd;
    color: white;
}

.btn-carrinho:hover {
    background: #0b5ed7;
    transform: translateY(-2px);
}

/* Voltar */
.btn-voltar {
    background: #f1f1f1;
    color: #333;
    border: 1px solid #ddd;
}

.btn-voltar:hover {
    background: #e7e7e7;
}

/* ===== TABLET ===== */
@media (max-width: 992px) {
    .produto-container {
        gap: 28px;
        padding: 24px;
    }

    .produto-info h1 {
        font-size: 1.7rem;
    }
}

/* ===== MOBILE ===== */
@media (max-width: 768px) {
    .produto-container {
        grid-template-columns: 1fr;
        padding: 16px;
        gap: 22px;
    }

    /* ‚≠ê imagem vem primeiro */
    .produto-img {
        order: 1;
    }

    .produto-info {
        order: 2;
    }

    .produto-info h1 {
        font-size: 1.45rem;
    }

    .preco {
        font-size: 1.7rem;
    }

    .btn-acao {
        padding: 14px 0;
        font-size: 1rem;
    }
}

/* ===== MOBILE PEQUENO ===== */
@media (max-width: 420px) {
    .produto-container {
        margin: 20px 10px;
        border-radius: 18px;
    }

    .produto-img img {
        border-radius: 18px;
    }
}


.quantidade-box {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
}

.qtd-input {
    width: 70px;
    text-align: center;
    font-size: 1rem;
    padding: 8px;
    border-radius: 10px;
    border: 1px solid #ddd;
    font-weight: 700;
}

.qtd-btn {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: none;
    background: #0d6efd;
    color: white;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    transition: .2s;
}

.qtd-btn:hover {
    background: #0b5ed7;
}
</style>


{% block breadcrumb %}
<nav class="breadcrumb">
    <a href="/">Home</a>
    <span>‚Ä∫</span>
    <a href="{% url 'pecas_reposicao' %}">Pe√ßas de Reposi√ß√£o</a>
    <span>‚Ä∫</span>
    <strong>{{ peca.nome }}</strong>
</nav>
{% endblock %}

<!-- ===== CONTAINER ===== -->
<div class="produto-container" id="container">

    <!-- IMAGEM -->
   <div class="produto-img">
    {% with img=peca.imagem_principal %}
        {% if img and img.imagem %}
            <img src="{{ img.imagem.url }}" alt="{{ peca.nome }}" loading="lazy">
        {% else %}
            <img src="{% static 'img/placeholder.png' %}" alt="Sem imagem" loading="lazy">
        {% endif %}
    {% endwith %}
</div>

    <!-- INFO -->
    <div class="produto-info">

        <h1>{{ peca.nome }}</h1>

        <p class="preco js-preco"
           data-valor="{{ peca.preco_venda|floatformat:2 }}">
           R$ 0,00
        </p>

        <p class="sec-titulo">Descri√ß√£o</p>
        <p class="descricao-produto">
            {{ peca.descricao_peca }}
        </p>


        <!-- ===== A√á√ïES ===== -->
        <div class="acoes-produto">

            <!-- WhatsApp -->
            <a href="https://wa.me/5511960563135?text=
            Ol√°! üëã%0A
            Tenho interesse na pe√ßa:%0A
            üîß {{ peca.nome|urlencode }}%0A
            üí∞ Pre√ßo: R$ {{ peca.preco_venda|floatformat:2 }}%0A%0A
            üîó {{ request.build_absolute_uri|urlencode }}"
               target="_blank"
               class="btn-acao btn-whatsapp">
               <i class="fab fa-whatsapp"></i>
               Falar com um vendedor
            </a>

            <div class="quantidade-box">
                <button type="button" class="qtd-btn" onclick="alterarQtd(-1)">‚àí</button>

                <input type="number"
                       id="quantidade-input"
                       value="1"
                       min="1"
                       class="qtd-input">

                <button type="button" class="qtd-btn" onclick="alterarQtd(1)">+</button>
            </div>

            <!-- Carrinho -->
            <button type="button"
                    class="btn-acao btn-carrinho"
                    onclick="adicionarAoCarrinho('peca', {{ peca.id }})">
                üõí Adicionar ao Carrinho
            </button>

            <!-- Voltar -->
            <a href="{% url 'pecas_reposicao' %}" class="btn-acao btn-voltar">
                ‚Üê Voltar
            </a>

        </div>

    </div>
</div>


<script>
function formatarMoedaBR(valor) {
    const numero = Number(valor);

    if (Number.isNaN(numero)) return '0,00';

    return numero.toLocaleString('pt-BR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
}

document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.js-preco').forEach(el => {
        const valor = el.dataset.valor?.replace(',', '.');
        el.innerText = 'R$ ' + formatarMoedaBR(valor);
    });
});

function alterarQtd(delta) {
    const input = document.getElementById('quantidade-input');
    let valor = parseInt(input.value) || 1;

    valor += delta;
    if (valor < 1) valor = 1;

    input.value = valor;
}

function adicionarAoCarrinho(tipo, id) {
    const qtd = document.getElementById('quantidade-input')?.value || 1;

    const formData = new FormData();
    formData.append('quantidade', qtd);

    fetch(`/carrinho/adicionar/${tipo}/${id}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        alert('Produto adicionado ao carrinho!');
    })
    .catch(() => {
        alert('Erro ao adicionar.');
    });
}
</script>

{% endblock %}