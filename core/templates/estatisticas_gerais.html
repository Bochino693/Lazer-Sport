{% extends 'base_adm.html' %}
{% block title %}Estat√≠sticas Gerais{% endblock %}
{% block content %}

<style>

    .dashboard-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
}

/* FILTROS MODERNOS */
.dashboard-filters{
    display:flex;
    gap:10px;
    background:rgba(255,255,255,0.04);
    padding:6px;
    border-radius:12px;
    backdrop-filter:blur(6px);
}

.filter-btn{
    padding:8px 16px;
    border-radius:10px;
    text-decoration:none;
    font-size:13px;
    font-weight:600;
    color:#cbd5f5;
    background:transparent;
    transition:.25s;
}

.filter-btn:hover{
    background:rgba(139,92,246,.15);
    color:#fff;
}

.filter-btn.active{
    background:linear-gradient(135deg,#7c3aed,#4f46e5);
    color:white;
    box-shadow:0 0 12px rgba(124,58,237,.45);
}

/* CARD HOVER */
.stats-card{
    transition:.25s;
}

.stats-card:hover{
    transform:translateY(-4px);
    box-shadow:0 14px 28px rgba(0,0,0,.35);
}

/* LINHAS */
.stats-table tr{
    transition:.15s;
}

.stats-table tr:hover{
    background:rgba(255,255,255,.04);
}

/* BLOCO CRESCIMENTO */
.growth-card{
    margin-top:25px;
}

.growth-table td{
    padding:8px 6px;
    border-bottom:1px solid rgba(255,255,255,.05);
    font-size:13px;
}

.day{
    color:#94a3b8;
}

.growth{
    text-align:right;
    font-weight:600;
    color:#4ade80;
}
.stats-wrapper {
    max-width: 1300px;
    margin: auto;
}

/* KPIs */
.stats-kpis {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
    gap: 20px;
    margin-bottom: 25px;
}

.kpi-box {
    background: linear-gradient(135deg,#1e293b,#0f172a);
    padding: 22px;
    border-radius: 14px;
    box-shadow: 0 10px 25px rgba(0,0,0,.25);
}

.kpi-box h3 {
    font-size: 13px;
    color: #94a3b8;
    margin: 0;
}

.kpi-box span {
    font-size: 30px;
    font-weight: bold;
    color: #f1f5f9;
}

/* GRID TABELAS */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px,1fr));
    gap: 20px;
}

/* CARD */
.stats-card {
    background: #1e293b;
    border-radius: 14px;
    padding: 18px;
    box-shadow: 0 8px 20px rgba(0,0,0,.25);
}

/* TITULO */
.stats-card h4 {
    margin-bottom: 10px;
    font-size: 16px;
    color: #8b5cf6;
}

/* TABELA */
.stats-table {
    width: 100%;
    border-collapse: collapse;
}

.stats-table td {
    padding: 10px 6px;
    border-bottom: 1px solid rgba(255,255,255,.05);
}

.rank {
    font-weight: bold;
    color: #fbbf24;
}

.name {
    color: #f1f5f9;
}

.count {
    text-align: right;
    color: #94a3b8;
    font-weight: 600;
}

/* TOP 1 destaque */
.top1 {
    background: rgba(139,92,246,.12);
    border-radius: 8px;
}
</style>

<div class="stats-wrapper">

<div class="dashboard-header">
    <h2>ESTAT√çSTICAS GERAIS</h2>

    <div class="dashboard-filters">
        <a href="?filtro=geral" class="filter-btn {% if filtro == 'geral' %}active{% endif %}">Geral</a>
        <a href="?filtro=7dias" class="filter-btn {% if filtro == '7dias' %}active{% endif %}">7 dias</a>
        <a href="?filtro=30dias" class="filter-btn {% if filtro == '30dias' %}active{% endif %}">30 dias</a>
        <a href="?filtro=ano" class="filter-btn {% if filtro == 'ano' %}active{% endif %}">Ano</a>
    </div>
</div>

<!-- KPIs -->
<div class="stats-kpis">
    <div class="kpi-box">
        <h3>Cliques Totais</h3>
        <span>{{ total_geral }}</span>
    </div>

    <div class="kpi-box">
        <h3>Brinquedos</h3>
        <span>{{ total_brinquedo_clicks }}</span>
    </div>

    <div class="kpi-box">
        <h3>Combos</h3>
        <span>{{ total_combo_clicks }}</span>
    </div>

    <div class="kpi-box">
        <h3>Promo√ß√µes</h3>
        <span>{{ total_promocao_clicks }}</span>
    </div>

    <div class="kpi-box">
        <h3>Categorias</h3>
        <span>{{ total_categoria_clicks }}</span>
    </div>
</div>

<!-- TABELAS -->
<div class="stats-grid">

<!-- BRINQUEDOS -->
<div class="stats-card">
<h4>üß∏ Brinquedos mais clicados</h4>
<table class="stats-table">
{% for item in top_brinquedos %}
<tr class="{% if forloop.first %}top1{% endif %}">
<td class="rank">#{{ forloop.counter }}</td>
<td class="name">{{ item.brinquedo_clicado__nome_brinquedo }}</td>
<td class="count">{{ item.total }}</td>
</tr>
{% empty %}
<tr><td>Sem dados</td></tr>
{% endfor %}
</table>
</div>

<!-- COMBOS -->
<div class="stats-card">
<h4>üéÅ Combos mais clicados</h4>
<table class="stats-table">
{% for item in top_combos %}
<tr class="{% if forloop.first %}top1{% endif %}">
<td class="rank">#{{ forloop.counter }}</td>
<td class="name">{{ item.descricao_combo }}</td>
<td class="count">{{ item.total }}</td>
</tr>
{% endfor %}
</table>
</div>

<!-- PROMO√á√ïES -->
<div class="stats-card">
<h4>üî• Promo√ß√µes mais clicadas</h4>
<table class="stats-table">
{% for item in top_promocoes %}
<tr class="{% if forloop.first %}top1{% endif %}">
<td class="rank">#{{ forloop.counter }}</td>
<td class="name">{{ item.descricao_promocao }}</td>
<td class="count">{{ item.total }}</td>
</tr>
{% endfor %}
</table>
</div>

<!-- CATEGORIAS -->
<div class="stats-card">
<h4>üìÇ Categorias mais clicadas</h4>
<table class="stats-table">
{% for item in top_categorias %}
<tr class="{% if forloop.first %}top1{% endif %}">
<td class="rank">#{{ forloop.counter }}</td>
<td class="name">{{ item.nome_categoria }}</td>
<td class="count">{{ item.total }}</td>
</tr>
{% endfor %}
</table>
</div>

<div class="stats-card growth-card">
<h4>üìà Crescimento de cliques por dia</h4>

<table class="stats-table growth-table">
<tr>
    <td class="day">Data</td>
    <td class="growth">Cliques</td>
</tr>

{% for dia in crescimento_diario %}
<tr>
    <td class="day">{{ dia.dia|date:"d/m" }}</td>
    <td class="growth">{{ dia.total }}</td>
</tr>
{% empty %}
<tr><td colspan="2">Sem dados</td></tr>
{% endfor %}
</table>
</div>

</div>
</div>


<script>
// anima entrada suave
document.querySelectorAll('.stats-card, .kpi-box').forEach((el,i)=>{
    el.style.opacity=0;
    el.style.transform='translateY(10px)';
    setTimeout(()=>{
        el.style.transition='.4s';
        el.style.opacity=1;
        el.style.transform='translateY(0)';
    }, i*70);
});

// contador animado KPIs
document.querySelectorAll('.kpi-box span').forEach(el=>{
    let final=parseInt(el.innerText)||0;
    let atual=0;
    let step=Math.ceil(final/30);

    let t=setInterval(()=>{
        atual+=step;
        if(atual>=final){
            atual=final;
            clearInterval(t);
        }
        el.innerText=atual;
    },20);
});
</script>


{% endblock %}
