{% extends "base_adm.html" %}
{% block content %}
{% load l10n %}

<style>
.promocoes-container {
    max-width: 1200px;
    margin: 40px auto;
    padding: 20px;
}

.btn-novo {
    display:inline-block;
    margin-bottom:25px;
    background:linear-gradient(135deg,#ff9800,#ff5722);
    color:white;
    padding:12px 22px;
    border-radius:16px;
    font-weight:700;
    text-decoration:none;
}

.grid-promocoes {
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:25px;
}

.card-promocao {
    background:#fff;
    border-radius:20px;
    box-shadow:0 8px 25px rgba(0,0,0,.1);
    overflow:hidden;
    transition:.3s;
}

.card-promocao:hover {
    transform:translateY(-6px);
}

.card-promocao img {
    width:100%;
    height:200px;
    object-fit:cover;
}

.card-body {
    padding:18px;
}

.card-body h3 {
    margin-bottom:6px;
}

.preco {
    font-size:1.4rem;
    font-weight:bold;
    color:#e53935;
    margin:10px 0;
}

.acoes a {
    display:block;
    text-align:center;
    padding:10px;
    border-radius:14px;
    color:white;
    font-weight:600;
    text-decoration:none;
    margin-top:6px;
}

.btn-editar { background:#ffc107; color:#222; }
.btn-excluir { background:#dc3545; }



.modal-overlay {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    backdrop-filter:blur(5px);
    z-index:1000;
}

.modal-card {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    width:92%;
    background:white;
    border-radius:24px;
    padding:24px;
    box-shadow:0 30px 80px rgba(0,0,0,.45);
    z-index:1001;
    animation:modalIn .25s ease;
}

@keyframes modalIn {
    from {
        opacity:0;
        transform:translate(-50%,-45%) scale(.96);
    }
    to {
        opacity:1;
        transform:translate(-50%,-50%) scale(1);
    }
}

.modal-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:15px;
}

.btn-close {
    width:38px;
    height:38px;
    border-radius:50%;
    border:none;
    background:#f3f3f3;
    cursor:pointer;
    font-size:18px;
}

</style>

<div class="promocoes-container">
    <h1>üî• Promo√ß√µes</h1>
<button class="btn-novo"
        onclick="abrirModal('{% url 'promocao_create' %}')">
    ‚ûï Nova Promo√ß√£o
</button>


    <div class="grid-promocoes">
        {% for promo in promocoes %}
        <div class="card-promocao">

            {% if promo.imagem_promocao %}
                <img src="{{ promo.imagem_promocao.url }}">
            {% endif %}

            <div class="card-body">
                <h3>{{ promo.descricao }}</h3>
                <p>üß∏ {{ promo.brinquedos.nome_brinquedo }}</p>

                <div class="preco money" data-valor="{{ promo.preco_promocao|unlocalize }}">
                    R$ 0,00
                </div>


                <div class="acoes">
                    <a href="{% url 'promocao_update' promo.id %}" class="btn-editar">‚úèÔ∏è Editar</a>
                    <a href="{% url 'promocao_delete' promo.id %}" class="btn-excluir">üóëÔ∏è Excluir</a>
                </div>
            </div>

        </div>
        {% empty %}
            <p>Nenhuma promo√ß√£o cadastrada.</p>
        {% endfor %}
    </div>
</div>

<!-- MODAL PROMO√á√ÉO -->
<div id="modalPromocao" style="display:none">

    <div class="modal-overlay" onclick="fecharModal()"></div>

    <div class="modal-card" style="max-width:600px">
        <div class="modal-header">
            <h3>Nova Promo√ß√£o</h3>
            <button class="btn-close" onclick="fecharModal()">‚úï</button>
        </div>

        <div id="modalConteudo">
            <p style="text-align:center">Carregando...</p>
        </div>
    </div>

</div>


<script>
function formatarMoedaBR(valor) {
    if (isNaN(valor)) valor = 0;
    return Number(valor).toLocaleString('pt-BR', {
        minimumFractionDigits:2,
        maximumFractionDigits:2
    });
}

document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".money").forEach(el => {
        el.textContent = "R$ " + formatarMoedaBR(el.dataset.valor);
    });
});


function abrirModal(url) {
    document.getElementById("modalPromocao").style.display = "block";
    document.getElementById("modalConteudo").innerHTML = "Carregando...";

    fetch(url, {
        headers: {
            "X-Requested-With": "XMLHttpRequest"
        }
    })
    .then(response => response.text())
    .then(html => {
        document.getElementById("modalConteudo").innerHTML = html;
    });
}


function fecharModal() {
    document.getElementById("modalPromocao").style.display = "none";
}


</script>

{% endblock %}
